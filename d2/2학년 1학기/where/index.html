<script>
var s= new Date().getTime();
</script>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./style.css">
    <style data="test"></style>
    <script>
        let Fun = null; //함수
        let a; //함수 좌항
        let b; //함수 우항
        let Wx= []; //함수 x의 위치
        let Wy= []; //함수 y의 위치
        let bracket = ""; //괄호속 식
        let canvas; //캔버스
        let ctx; //ctx
        const _Setting= () =>{
            canvas = document.getElementById('canvas'); //canvas
            ctx = canvas.getContext('2d'); //canvas.getContext
            canvas.style.left = (window.innerWidth - canvas.width) / 2 + 'px'; //center
            canvas.style.top = (window.innerHeight - canvas.height) / 2 + 'px'; //center
            ctx.lineCap = "round";
            ctx.strokeStyle = "#333";
            ctx.beginPath();
            ctx.moveTo(0, canvas.width / 2);
            ctx.lineTo(canvas.height, canvas.width / 2);
            ctx.stroke();
            ctx.moveTo(canvas.height / 2, 0);
            ctx.lineTo(canvas.height / 2, canvas.width);
            ctx.stroke();
            ctx.closePath();
            ctx.beginPath();
        }
        //colorpicker
        const _SetColor= () =>{
            /* setColor */
            let Box= document.getElementById("Color_box");

            let color_canvas = document.getElementById("Choice_color"); //bar
            let color_ctx = color_canvas.getContext("2d"); //barctx
            let thumb = document.getElementById('thumb'); //thumb
            let tcx; //click x
            let tmx; //move x
            let tl; //left
            let tp = false; //press

            let cc = document.getElementById('Choice_bw'); //b,w
            let ct = cc.getContext('2d'); //b,w ctx
            let bw= document.getElementById("bw");
            let bcx;let bcy;//click x,y
            let bmx;let bmy;//move x,y
            let bl;let bt;//left, top
            let bp=false;//press
            let lx="255.0";let ly="0.0";// last x,y
            const _Color = () => {
                var grd = color_ctx.createLinearGradient(0, 0, 255, 0);
                grd.addColorStop(0.1, "hsl(0,100%,50%)");
                grd.addColorStop(1 / 6, "hsl(60,100%,50%)");
                grd.addColorStop(2 / 6, "hsl(120,100%,50%)");
                grd.addColorStop(3 / 6, "hsl(180,100%,50%)");
                grd.addColorStop(4 / 6, "hsl(240,100%,50%)");
                grd.addColorStop(5 / 6, "hsl(300,100%,50%)");
                grd.addColorStop(0.9, "hsl(360,100%,50%)");
                color_ctx.fillStyle = grd;
                color_ctx.fillRect(0, 0, 255, 15);
            }; //background gradient//background gradient
            _Color(); //background gradient
            const _ClickBar = (e,target) => { //color_canvas 클릭시
                let rect = target.getBoundingClientRect();
                if(target.id=="Choice_color"){
                    let x = (e.clientX - rect.left + 6);
                    _Move(x, thumb, 6, 254);
                }else{
                    let x = (e.clientX - rect.left + 9);
                    let y = (e.clientY - rect.top +37);
                    _Move(x, bw, 9, 261, y);
                }
                if (e.target.id == "Choice_color") {
                    let rect = color_canvas.getBoundingClientRect();
                    let x = (e.clientX - rect.left);
                    let y = (e.clientY - rect.top);
                    let get_rgb = color_ctx.getImageData(x, y, 1, 1).data; //get rgb_code
                    _ApplyColor(get_rgb);
                }
            };
            const _FColor= (x,y) =>{//아래꺼 thumb움직일때마다
                let rgb = ct.getImageData(x, y, 1, 1).data;
                let g1= rgb[0];
                let g2= rgb[1];
                let g3= rgb[2];
                Box.style.background= `rgb(${g1},${g2},${g3})`; //stroke
                ctx.strokeStyle = `rgb(${g1},${g2},${g3})`; //stroke
            }
            const _ApplyColor = (g) => {//위에꺼 thumb움직일때마다
                /* box fill */
                thumb.style.background = `rgb(${g[0]},${g[1]},${g[2]})`; //thumb
                for (var i = 0; i <= 256; i++) {
                    var grd = color_ctx.createLinearGradient(0, 0, 0, 255);
                    let g1=255-((255-g[0])/255*i);
                    let g2=255-((255-g[1])/255*i);
                    let g3=255-((255-g[2])/255*i);
                    grd.addColorStop(0.1,`rgb(${g1},${g2},${g3})`);
                    grd.addColorStop(0.9, "rgb(0,0,0)");
                    ct.fillStyle=grd;
                    ct.fillRect(i, 0, 1, 255);
                }
                _FColor(lx,ly);
                /* //box fill */
            } //apply color
            const _Move = (x,t, min, max, y=false) => {//move thumb
                if(y!=false){
                    if(291 < y) {
                        t.style.top = "291px";
                    } else if(y < 37) {
                        t.style.top = "37px";
                    } else {
                        t.style.top = y + "px";
                    }
                }
                if (max < x) {
                    t.style.left = max + "px";
                } else if (x < min) {
                    t.style.left = min + "px";
                } else {
                    t.style.left = x + "px";
                }
            }
            const _ApplyBw= (rgb) =>{
                Box.style.background= `rgb(${rgb[0]}, ${rgb[1]}, ${rgb[2]})`;
            };
            _ApplyColor(color_ctx.getImageData(0, 1, 1, 1).data);
            color_canvas.addEventListener("mousedown", (e) => {//bar click
                _ClickBar(e,color_canvas);
                tcx = e.clientX;
                tl = parseInt(thumb.style.left, 10);
                tp = true;
            }); //bar click
            thumb.addEventListener("mousedown", (e) => {//thumb click
                tcx = (e.clientX);
                tl = parseInt(thumb.style.left, 10);
                tp = true;
            }); //thumb click

            cc.addEventListener("mousedown", (e) =>{
                _ClickBar(e,cc);
                bcx = (e.clientX);
                bl = parseInt(bw.style.left, 10);
                bcy = (e.clientY);
                bt = parseInt(bw.style.top, 10);
                bp = true;
            });//명도 채도조절박스
            bw.addEventListener("mousedown", (e) =>{
                bcx = (e.clientX);
                bl = parseInt(bw.style.left, 10);
                bcy = (e.clientY);
                bt = parseInt(bw.style.top, 10);
                bp = true;
            });//명도 채도조절thumb
            window.addEventListener("mousemove", (e) => { //click->move
                if (tp) {//위에꺼
                    let rect = thumb.getBoundingClientRect();
                    tmx = (e.clientX);
                    let x = tmx - tcx + tl;
                    _Move(x, thumb, 6, 254);
                    let gx = ((parseInt(thumb.style.left, 10) - 6) * (255 / 249)).toFixed(1); //get x
                    let get_rgb = color_ctx.getImageData(gx, 1, 1, 1).data; //get x.colordata
                    _ApplyColor(get_rgb);
                }
                if (bp) {//아래꺼
                    let rect = bw.getBoundingClientRect();
                    bmx = (e.clientX);
                    bmy = (e.clientY);
                    let x = bmx - bcx + bl;
                    let y = bmy - bcy + bt;
                    _Move(x, bw, 9, 261, y);
                    let gx = ((parseInt(bw.style.left, 10) - 9) * (255 / 252)).toFixed(1); //get x 9~216 252*x=255
                    let gy = ((parseInt(bw.style.top, 10) - 37) * (255 / 255)).toFixed(1); //get x 37~291
                    _FColor(gx, gy);
                }
            });
            window.addEventListener("mouseup", (e) => {
                if (tp)//위에꺼
                    tp = !tp;
                if (bp){//아래꺼
                    bp = !bp;
                    lx = ((parseInt(bw.style.left, 10) - 9) * (254 / 252)).toFixed(1); //get x 9~216 252*x=255
                    ly = ((parseInt(bw.style.top, 10) - 37) * (254 / 255)).toFixed(1); //get x 37~291
                }
            }); //click->move->up
            /* //setColor */
        };//컬러피커
        //drawing
        const _Drawing= () =>{
            /* drawing */
            let press = false; //drawing canvas mousedown
            let dx; //drawing canvas mousedown x
            let dy; //drawing canvas mousedown y
            let mx; //drawing canvas mousemove x
            let my; //drawing canvas mousemove x
            let where = document.getElementById("where"); //위치표시박스
            const _Where = (e) => { //위치표시박스에 위치넣어줌
                where.style.left = (e.pageX + 30) + "px";
                where.style.top = (e.pageY - 30) + "px";
                where.innerText = `(${(dx-canvas.width/2)/100}, ${(canvas.height/2-dy)/100})`;
            }
            const getW = (e, w) => { //get x,y location
                return w ? (e.pageX - parseInt(canvas.style.left, 10)) : (e.pageY - parseInt(canvas.style
                    .top, 10));
            }
            canvas.addEventListener("mousedown", (e) => {
                ctx.beginPath();
                dx = getW(e, true); //getx
                dy = getW(e, false); //gety
                press = true; //누르는중
                ctx.moveTo(dx, dy);
                ctx.lineTo(dx, dy);
                ctx.stroke();
                _Where(e); //위치표시
            });
            window.addEventListener("mousemove", (e) => {
                if (press) {
                    mx = getW(e, true);
                    my = getW(e, false);
                    ctx.moveTo(dx, dy);
                    ctx.lineTo(mx, my);
                    ctx.stroke();
                    dx = mx;
                    dy = my;
                    e.target.id == 'canvas' ?
                        _Where(e) :
                        where.innerText = "";
                }
            });
            window.addEventListener("mouseup", (e) => {
                press = false;
                where.innerText = "";
                ctx.closePath();
            });
            /* //drawing */
        }//마우스로 그리기
        //form.submit()
        const _Checking = (v) =>{//일반문자가 있는지
            switch (v) {
                case "1":
                case "2":
                case "3":
                case "4":
                case "5":
                case "6":
                case "7":
                case "8":
                case "9":
                case "0":
                case "+":
                case "-":
                case "*":
                case "/":
                case "^":
                case ")":
                case "(":
                case "x":
                case "y":
                case "=":
                return true;
                break;
                default:
                return false;
            }
        }
        const _Check= (f) =>{
            if(f.length<1)
                return false;
            for(var i=0;i<f.split("").length;i++){
                if(!_Checking(f[i]))
                    return false;
            }
        }//인풋이 비어있거나 잘못된 문자가 들어가는지 체크
        const _GetXY = (t, w) => {//x나y의 위치를 리턴해줌
            let arr = [];//배열 선언
            t.map((v, e) => {//a나 b를 맵으로 훑어봄
                v == w ? arr[e] = e : "";//만약에 값이 x나 y랑 일치하면 배열에 추가시킴
            });
            return arr;//배열 리턴
        };
        //_Line
        const _InsetX = (WX, B, i) => {//x위치에 숫자넣어줌
            WX.map((v, e) => { //Wx에 넣어둔 x위치에 i값을 넣어줌
                if (!isNaN(Number(B[WX[e] - 1])))
                B[WX[e]] = "*" + i; //넣어줌
                else
                B[WX[e]] = '(' + i + ')'; //넣어줌
            });
        };
        const _Line = (WX, B, i, tf) => {//x위치배열, 식, x값, move인지 line인지 불린값
            let fb= B.slice();
            let onbracket = false; //default: false
            bracket = ""; //괄호속 내용
            // _InsetX(WX, B, i); //b의 X위치에 값넣어줌
            //+, -, *, / 가능
                // fb.map((v,n) =>{
                //     if(v=='x')
                //         fb[n]=i;
                // });
                // let y=eval(fb.join(""));
                // if(tf){
                //     console.log(fb);
                //     console.log(`${i},${y}`);
                // }
            //+, -, *, /, ^ 가능
                // let im2=i;
                // fb.map((v,n) =>{
                //     if(v=='x'){
                //         fb[n]=im2;
                //     }
                //     if(v=='^'){
                //         let jg= "";
                //         for(var i=0;i<fb[n+1]-1;i++){
                //             jg+= "*"+fb[n-1];
                //         }
                //         fb[n]= jg;
                //         fb[n+1]= "";
                //     }
                // });
                // let y=eval(fb.join(""));
                // if(tf){
                //     console.log(fb);
                //     console.log(`${i},${y}`);
                // }
            //+, -, *, /, ^, 1x~99x...nX, () 가능
                // let im2=i;
                // fb.map((v,n) =>{
                //     if(v=='x'){
                //         fb[n]=im2;
                //         if(!isNaN(fb[n-1]))
                //             fb[n-1]=fb[n-1]+"*";
                //     }
                // });
                // fb.map((v,n) =>{
                //     if(v=='^'){
                //         let jg= "";
                //         for(var i=0;i<fb[n+1]-1;i++){
                //             jg+= "*"+fb[n-1];
                //         }
                //         fb[n]= jg;
                //         fb[n+1]= "";
                //     }
                // });
                // let y=eval(fb.join(""));
                // if(tf){
                //     console.log(fb);
                //     console.log(`${i},${y}`);
                // }
            //+, -, *, /, ^, 1x~99x...nX, (), -x 가능
                // let im2=i;
                // fb.map((v,n) =>{
                //     if(v=='x'){
                //         fb[n]=im2;
                //         if(fb[n-1]=='-'){
                //             fb[n]="("+im2+")";
                //         }
                //         if(!isNaN(fb[n-1]))
                //             fb[n-1]=fb[n-1]+"*";
                //     }
                // });
                // fb.map((v,n) =>{
                //     if(v=='^'){
                //         let jg= "";
                //         for(var i=0;i<fb[n+1]-1;i++){
                //             jg+= "*"+fb[n-1];
                //         }
                //         fb[n]= jg;
                //         fb[n+1]= "";
                //     }
                // });
                // let y=eval(fb.join(""));
                // if(tf){
                //     console.log(fb);
                //     console.log(`${i},${y}`);
                // }
            //+, -, *, /, ^, 1x~99x...nX, (), -x, ()() 가능
                let im2=i;
                fb.map((v,n) =>{
                    if(v=='x'){
                        fb[n]=im2;
                        if(fb[n-1]=='-'){
                            fb[n]="("+im2+")";
                        }
                        if(!isNaN(fb[n-1]))
                            fb[n-1]=fb[n-1]+"*";
                    }
                });
                fb.map((v,n) =>{
                    if(v=='^'){
                        if(fb[n-1]==')'){

                        }else{
                            let jg= "";
                            for(var i=0;i<fb[n+1]-1;i++){
                                jg+= "*"+fb[n-1];
                            }
                            fb[n]= jg;
                            fb[n+1]= "";
                        }
                    }
                    if(v=='('){
                        if(isNaN(Number(fb[n-1]))==false || fb[n-1]==')'){
                            fb[n]='*(';
                        }
                    }
                });
                let y=eval(fb.join(""));
                if(tf){
                    console.log(fb);
                    console.log(`${i},${y}`);
                }
            // let Lb = B.slice(); //b는 그대로두고 b속의 값만 가져옴
            // Lb.map((v, n) => {
            //     switch (Lb[n]) {
            //         case '(':
            //             while (Lb[n] != ')') {
            //                 if (Lb[n] == '^')
            //                     bracket += '**';
            //                 else
            //                     bracket += Lb[n];
            //                 n++;
            //             }
            //             bracket += Lb[n];
            //             n++;
            //             break;
            //         case '^':
            //             let sq = "";
            //             for (var i = 0; i < Lb[n + 1] - 1; i++) {
            //                 sq += "*" + Lb[n - 1];
            //             }
            //             Lb[n] = sq;
            //             Lb[n + 1] = "";
            //             break;
            //         default:
            //     }
            // });
            // evr = "";
            // m = undefined;
            // for (var j = 0; j < Lb.length; j++) { //evr에 넣어줌
            //     if (onbracket) {
            //         if (Lb[j] == ')')
            //             onbracket = false;
            //     } else {
            //         if (m != undefined) { //j-1 == "-"
            //             if (Lb[j] != '(') {
            //                 if (Lb[j - 1] != undefined)
            //                     evr += "-" + Lb[j];
            //                 else
            //                     evr += "-" + Lb[j];
            //             } else if (Lb[j + 1] == '^') {
            //                 evr += '(' + Lb[j];
            //                 j++;
            //                 for (var p = 1; p < Lb[j + 1]; p++) {
            //                     evr += "*" + Lb[j - 1];
            //                 }
            //                 evr += ')';
            //                 j++;
            //             } else if (Lb[j] == '(') {
            //                 onbracket = true;
            //                 evr += "(-1)*" + bracket;
            //             } else {
            //                 if (Lb[j - 1] != undefined)
            //                     evr += "-" + B[j];
            //                 else
            //                     evr += "-" + B[j];
            //             }
            //             m = undefined;
            //         } else {
            //             if (Lb[j] == '-') { // j == "-"
            //                 if (m == undefined) { // m값이 없으면 m == j
            //                     m = j;
            //                 }
            //             } else if (Lb[j + 1] == '^') {
            //                 evr += '(' + Lb[j];
            //                 j++;
            //                 for (var p = 1; p < Lb[j + 1]; p++) {
            //                     evr += "*" + Lb[j - 1];
            //                 }
            //                 evr += ')';
            //                 j++;
            //             } else { // j != "-"
            //                 if (Lb[j] == '(') {
            //                     onbracket = true;
            //                     evr += bracket;
            //                 } else {
            //                     evr += Lb[j];
            //                 }
            //             }
            //         }
            //     }
            // }
            // let xl = ((i * 100) + 400).toFixed(2); //x location
            // let yl = ((-(eval(evr) * 100)) + 400).toFixed(2); //y location
            // if (810 >= yl && yl >= -10) //in canvas
            //     tf ? ctx.moveTo(xl, yl) : (ctx.lineTo(xl, yl), ctx.stroke());
        }
        const _Submit= () =>{
            Fun= document.getElementById("Function").value; //Fun에 input 값 넣어줌
            document.getElementById("Function").value = ""; //input reset
            _Check(Fun);//인풋이 비어있거나 잘못된 문자가 들어가는지 체크
            a = Fun.split("=")[0].split(""); //좌항
            b = Fun.split("=")[1].split(""); //우항
            Wx = _GetXY(b, 'x'); //x의 위치를 가져옴
            Wy = _GetXY(a, 'y'); //y의 위치를 가져옴
            let evr = ""; //eval
            let m = undefined; //minus
            ctx.beginPath(); //start;
            let n= 1;
            for (var i = -4; i <= 4; i = i + n) { //-4~4 line draw
                _Line(Wx, b, i, true); //move
                _Line(Wx, b, i + n, false); //line
            }
            ctx.closePath(); //end
        }
window.onload = () => {
            _Setting();//캔버스선언,중앙으로,격자
            _SetColor();//컬러피커
            _Drawing();//마우스로 그리기
            let form = document.getElementById("get_f"); //form
            form.addEventListener("submit", (e) => { //submit
                e.preventDefault();
                _Submit();
            });
            /* //function and draw */
            /* ex) function */
            // ctx.strokeStyle = "#f00";
            // document.getElementById('Function').value = 'y=x^3-x^2-x+1';
            // document.getElementsByTagName('button')[0].click();
            // ctx.strokeStyle = "#0ff";
            // document.getElementById('Function').value = 'y=x^2';
            // document.getElementsByTagName('button')[0].click();
            // ctx.strokeStyle = "#f00";
            /* //ex) function */
}
    </script>
    <title>Where</title>
</head>

<body>
    <div id="qwe" style="width:10px;height:50px;position:absolute;bottom:10px;left:10px;background:black;"></div>
    <canvas id="canvas" width="800" height="800">turn on js</canvas>
    <form id="get_f" action="" method="">
        <input id="Function" type="text" placeholder="y=x^2" autofocus/>
        <button type="submit">입력</button>
        <br>
        <div id="Color_box"></div>
        setColor
    </form>
    <span id="where"></span>
    <div id="Color_set">
        <canvas id="Choice_color" width="256" height="15">
        </canvas>
        <span id="thumb" style="left: 6px;background: red;"></span>
        <canvas id="Choice_bw" width="256" height="255">
        </canvas>
        <span id="bw" style="left: 261px;top: 37px;background: rgba(255,255,255, 0.3);"></span>
    </div>
</body>
</html>
<!-- <script src="https://code.jquery.com/jquery-3.2.1.js"></script>
<script>
function re(t, n, e){
    if( (t==undefined || t.length<1 ) ){
        return re(document.getElementsByTagName("*")[n], n);
    }else{
        return console.log(t);
    }
}
var len=$("*").length;
$("#qwe").ready(function () {
    for(var i=0;i<len;i++){
        re(document.getElementsByTagName("*")[i], i);
        $("#qwe").animate({'width':10+i+'px'},0);
        console.log(10+i+'px');
        if(i==len-1){
            var e= new Date().getTime();
            console.log(`loading complete t:${(e-s)/1000}s`);
        }
    }
});
</script> -->
