<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="UTF-8">
	<title>test</title>
	<style>
		html,body{width: 100vw;height: 100vh;display: flex;justify-content: center;align-items: center;background: #333;}
		canvas{background: #fff;}
	</style>
</head>
<body>
	<canvas id="canvas" width="1200" height="675"></canvas>
	<script>
		var FPS= 60;
		var images= {};
		var loadImage= function (sources, callback){
			var nb = 0;
			var loaded = 0;
			var imgs = {};
			for(var i in sources){
				nb++;
				imgs[i] = new Image();
				imgs[i].src = sources[i];
				imgs[i].onload = function(){
					loaded++;
					if(loaded == nb){
						callback(imgs);
					}
				}
			}
		}
		// var canvas= document.getElementById("canvas");
		// var ctx= canvas.getContext("2d");
		function Slide (){
			this.canvas= document.getElementById("canvas");
			this.ctx= canvas.getContext("2d");
			this.W= canvas.width;
			this.H= canvas.height;
			this.S= 150;
			this.L= 300;
			this.location= [
				{
					x: 0,
				},
				{
					x: 0,
				},
				{
					x: 0,
				},
			];
		}
		Slide.prototype.draw= function (){
			for(var i=0; i<9; i++){// cliping, drawing
				var j= i%3;
				
				this.ctx.save();
			    this.ctx.beginPath();
			    switch(j){
			    	case 0:
					    this.ctx.moveTo(0, 0);
					    this.ctx.lineTo(this.W, 0);
					    this.ctx.lineTo(this.W, this.S);
					    this.ctx.lineTo(0, this.L);
			    		break;
			    	case 1:
			    		this.ctx.moveTo(0, this.L);
					    this.ctx.lineTo(this.W, this.S);
					    this.ctx.lineTo(this.W, this.L+200);
					    this.ctx.lineTo(0, this.S+500);
			    		break;
			    	case 2:
			    		this.ctx.moveTo(0, this.S+500);
					    this.ctx.lineTo(this.W, this.L+200);
					    this.ctx.lineTo(this.W, this.H);
					    this.ctx.lineTo(0, this.H);
			    		break;
			    }
			    this.ctx.closePath();
			    this.ctx.clip();
			    this.ctx.drawImage(images, this.location[j].x, 0);
			    this.ctx.restore();
			}
			var self = this;
			if(self.location[2].x>-1200)
			requestAnimationFrame(function(){
				self.draw();
			});
		}
		/*
			default= 0;
		*/
		Slide.prototype.update= function (){
			var self= this;
			// transition= 1.5s;
			// 0s ~ 1s = 0 ~ 850 // 60fps
			// 1s ~ 1.5s = 850 ~ 1200 // 30fps

			this.location[0].x= 
				this.location[0].x>-this.W
					? this.location[0].x<-850
						? this.location[0].x+this.location[0].x/80
						: (this.location[0].x*1.07)-1
					: this.location[0].x;
			console.log(this.location[0].x);

			setTimeout(function (){
				self.location[1].x= 
					self.location[1].x>-self.W
						? self.location[1].x<-850
							? self.location[1].x+self.location[1].x/80
							: (self.location[1].x*1.07)-1
						: self.location[1].x;
				setTimeout(function (){
					self.location[2].x= 
						self.location[2].x>-self.W
							? self.location[2].x<-850
								? self.location[2].x+self.location[2].x/80
								: (self.location[2].x*1.07)-1
							: self.location[2].x;
				}, 100)
			}, 100)
			if(self.location[2].x>-1200){
				setTimeout(function (){
					self.update();
				}, 1000/FPS);
			}
		}
		Slide.prototype.display= function (){

			
		}
		window.onload= _ =>{
			var src= ["https://code.d2.co.kr/jewdri/smashtest/images/sec01_bg.png", "https://code.d2.co.kr/jewdri/smashtest/images/sec02_bg.png"];
			var start= function (){
				var slide= new Slide();
				slide.draw();//draw image
				slide.update();//update image
			}
			loadImage(src, function (imgs){
				var FullImage= document.createElement("canvas");
				var FullImage_ctx= FullImage.getContext('2d');
				FullImage.width= 2400;
				FullImage.height= 675;
				FullImage_ctx.drawImage(imgs[0], 0, 0, 1200, 675);
				FullImage_ctx.drawImage(imgs[1], 1200, 0, 1200, 675);
				images= FullImage;

				start();
			});
		}
	</script>
</body>
</html>